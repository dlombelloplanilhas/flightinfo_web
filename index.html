<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlightInfo BR - Voos Offshore</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #012e01 0%, #135802 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1250px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .search-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .search-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 20px;
            align-items: end;
        }

        .input-group {
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
            font-size: 0.9rem;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-group select {
            cursor: pointer;
        }

        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .status-bar {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e1e5e9;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .results-count {
            font-weight: 500;
            color: #667eea;
        }

        .status-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .last-update {
            font-size: small;
            color: #101011;
        }

        .filter-info {
            font-size: small;
            color: #666;
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 8px;
        }

        .loading-spinner {
            width: 30px;
            height: 30px;
            border: 4px solid #e1e5e9;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .table-container {
            overflow-x: auto;
            max-height: 600px;
        }

        table {
            width: 99.5%;
            margin: 0 auto;
            border-collapse: collapse;
        }

        th {
            background: #667eea;
            color: white;
            padding: 20px 15px;
            text-align: left;
            font-weight: 500;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e1e5e9;
            font-size: 0.9rem;
        }

        .flight-local {
            font-size: small;
            max-width: 200px;
        }

        .flight-row {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .flight-row:hover {
            background: #f0f8ff;
            transform: translateX(2px);
        }

        .aircraft-type {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .aircraft-type.helicopter {
            background: #e3f2fd;
            color: #1976d2;
        }

        .aircraft-type.helicopter_br {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .aircraft-type.airplane {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 30px;
            border: 1px solid #f5c6cb;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            color: white;
            opacity: 0.8;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .search-form {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .search-card,
            .results-card {
                margin: 0 -10px;
                border-radius: 15px;
            }

            .status-bar {
                flex-direction: column;
                align-items: flex-start;
            }

            th,
            td {
                padding: 12px 8px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header class="header">
            <h1>üöÅ <b>FlightInfo BR</b></h1>
            <p>Consulta de voos offshore em tempo real</p>
        </header>

        <div class="search-card">
            <form class="search-form" onsubmit="return false;">
                <div class="input-group">
                    <label for="airport">Aeroporto</label>
                    <input type="text" id="airport" placeholder="Ex: SBME, SBFS" style="text-transform: uppercase;">
                </div>

                <div class="input-group">
                    <label for="aircraft">Aeronave</label>
                    <input type="text" id="aircraft" placeholder="Ex: PSCDU, PROHA" style="text-transform: uppercase;">
                </div>

                <div class="input-group">
                    <label for="aircraftType">Tipo de Aeronave</label>
                    <select id="aircraftType">
                        <option value="all">Todos</option>
                        <option value="helicopter_br">üöÅ Helic√≥pteros BR</option>
                        <option value="helicopter">üö° Helic√≥pteros</option>
                        <option value="airplane">‚úàÔ∏è Avi√µes</option>
                    </select>
                </div>

                <button type="button" class="search-btn" onclick="searchFlightsButton()">
                    Buscar
                </button>
            </form>
        </div>

        <div class="results-card" id="results">
            <div class="status-bar">
                <span class="results-count" id="resultsCount">0 voos encontrados</span>
                <div class="status-info">
                    <span class="filter-info" id="filterInfo" style="display: none;"></span>
                    <span class="last-update" id="lastUpdate"></span>
                    <div class="loading-spinner" id="loading" style="display: none;"></div>
                </div>
            </div>

            <div id="errorContainer"></div>

            <div class="table-container">
                <table id="flightTable">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Tipo</th>
                            <th>Aeronave</th>
                            <th>Origem</th>
                            <th>Destino</th>
                            <th>Decolagem</th>
                            <th>Pouso</th>
                            <th>Dura√ß√£o</th>
                            <th>Track</th>
                        </tr>
                    </thead>
                    <tbody id="flightData"></tbody>
                </table>
            </div>

            <div class="empty-state" id="emptyState" style="display: none;">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M21,16V14L13,9V7A1,1 0 0,0 12,6A1,1 0 0,0 11,7V9L3,14V16L11,13.5V19L8,20.5V22L12,21L16,22V20.5L13,19V13.5L21,16Z" />
                </svg>
                <h3>Nenhum voo encontrado</h3>
                <p>Tente ajustar os filtros de busca</p>
            </div>
        </div>

        <footer class="footer">
            <p>&copy; 2025 FlightInfo BR - Dados via FlightAware API</p>
        </footer>
    </div>

    <script>
        const aircraftsBr = [
            { "prefixo": "PR-AIE", "empresa": "L√≠der" },
            { "prefixo": "PR-AIF", "empresa": "L√≠der" },
            { "prefixo": "PR-AIG", "empresa": "L√≠der" },
            { "prefixo": "PR-BGB", "empresa": "Omni" },
            { "prefixo": "PR-JBK", "empresa": "Omni" },
            { "prefixo": "PR-BGT", "empresa": "CHC" },
            { "prefixo": "PR-BGU", "empresa": "CHC" },
            { "prefixo": "PR-BGX", "empresa": "Omni" },
            { "prefixo": "PR-BGY", "empresa": "CHC" },
            { "prefixo": "PR-BGZ", "empresa": "CHC" },
            { "prefixo": "PR-CGE", "empresa": "CHC" },
            { "prefixo": "PR-CGF", "empresa": "CHC" },
            { "prefixo": "PR-CGK", "empresa": "CHC" },
            { "prefixo": "PR-CGN", "empresa": "Omni" },
            { "prefixo": "PR-CGO", "empresa": "Omni" },
            { "prefixo": "PR-CGP", "empresa": "CHC" },
            { "prefixo": "PR-CGS", "empresa": "CHC" },
            { "prefixo": "PR-CGT", "empresa": "CHC" },
            { "prefixo": "PR-CGW", "empresa": "CHC" },
            { "prefixo": "PR-CHT", "empresa": "Omni" },
            { "prefixo": "PR-CPV", "empresa": "CHC" },
            { "prefixo": "PR-EPV", "empresa": "L√≠der" },
            { "prefixo": "PR-JAA", "empresa": "L√≠der" },
            { "prefixo": "PR-JAR", "empresa": "L√≠der" },
            { "prefixo": "PR-JAW", "empresa": "L√≠der" },
            { "prefixo": "PR-JBE", "empresa": "L√≠der" },
            { "prefixo": "PR-JBI", "empresa": "L√≠der" },
            { "prefixo": "PR-JBO", "empresa": "L√≠der" },
            { "prefixo": "PR-JBQ", "empresa": "L√≠der" },
            { "prefixo": "PR-JHC", "empresa": "L√≠der" },
            { "prefixo": "PR-JHD", "empresa": "L√≠der" },
            { "prefixo": "PR-JHE", "empresa": "L√≠der" },
            { "prefixo": "PR-JHG", "empresa": "L√≠der" },
            { "prefixo": "PR-JKC", "empresa": "L√≠der" },
            { "prefixo": "PR-JKE", "empresa": "L√≠der" },
            { "prefixo": "PR-JKJ", "empresa": "L√≠der" },
            { "prefixo": "PR-JKK", "empresa": "L√≠der" },
            { "prefixo": "PR-JKM", "empresa": "L√≠der" },
            { "prefixo": "PR-CHQ", "empresa": "Omni" },
            { "prefixo": "PR-LCR", "empresa": "Omni" },
            { "prefixo": "PR-OHA", "empresa": "Omni" },
            { "prefixo": "PR-OHB", "empresa": "Omni" },
            { "prefixo": "PR-OHE", "empresa": "Omni" },
            { "prefixo": "PR-OHF", "empresa": "Omni" },
            { "prefixo": "PR-OHG", "empresa": "Omni" },
            { "prefixo": "PR-OHJ", "empresa": "Omni" },
            { "prefixo": "PR-OHK", "empresa": "Omni" },
            { "prefixo": "PR-OHL", "empresa": "Omni" },
            { "prefixo": "PR-OHN", "empresa": "Omni" },
            { "prefixo": "PR-OHP", "empresa": "Omni" },
            { "prefixo": "PR-OHQ", "empresa": "Omni" },
            { "prefixo": "PR-OHR", "empresa": "Omni" },
            { "prefixo": "PR-OHU", "empresa": "Omni" },
            { "prefixo": "PR-OHV", "empresa": "Omni" },
            { "prefixo": "PR-OHX", "empresa": "Omni" },
            { "prefixo": "PR-OHY", "empresa": "Omni" },
            { "prefixo": "PR-OHZ", "empresa": "Omni" },
            { "prefixo": "PR-OOA", "empresa": "Omni" },
            { "prefixo": "PR-OOC", "empresa": "Omni" },
            { "prefixo": "PR-OOL", "empresa": "Omni" },
            { "prefixo": "PR-OON", "empresa": "Omni" },
            { "prefixo": "PR-OOP", "empresa": "Omni" },
            { "prefixo": "PR-OOR", "empresa": "Omni" },
            { "prefixo": "PR-OOS", "empresa": "Omni" },
            { "prefixo": "PR-OOT", "empresa": "Omni" },
            { "prefixo": "PR-OOU", "empresa": "Omni" },
            { "prefixo": "PR-OOX", "empresa": "Omni" },
            { "prefixo": "PR-OOY", "empresa": "Omni" },
            { "prefixo": "PR-OTH", "empresa": "Omni" },
            { "prefixo": "PR-OTI", "empresa": "Omni" },
            { "prefixo": "PR-OTN", "empresa": "Omni" },
            { "prefixo": "PR-OTP", "empresa": "Omni" },
            { "prefixo": "PR-OTQ", "empresa": "Omni" },
            { "prefixo": "PR-OTS", "empresa": "Omni" },
            { "prefixo": "PR-OTU", "empresa": "Omni" },
            { "prefixo": "PR-OTW", "empresa": "Omni" },
            { "prefixo": "PR-OTX", "empresa": "Omni" },
            { "prefixo": "PR-OTY", "empresa": "Omni" },
            { "prefixo": "PS-BTA", "empresa": "Bristow" },
            { "prefixo": "PS-BTB", "empresa": "Bristow" },
            { "prefixo": "PS-BTC", "empresa": "Bristow" },
            { "prefixo": "PS-BTF", "empresa": "Bristow" },
            { "prefixo": "PS-BTJ", "empresa": "Bristow" },
            { "prefixo": "PS-BTK", "empresa": "Bristow" },
            { "prefixo": "PS-BTL", "empresa": "Bristow" },
            { "prefixo": "PR-MLL", "empresa": "Bristow" },
            { "prefixo": "PS-BTW", "empresa": "Bristow" },
            { "prefixo": "PS-CDR", "empresa": "Costa do Sol" },
            { "prefixo": "PS-CDT", "empresa": "Costa do Sol" },
            { "prefixo": "PS-CDU", "empresa": "Costa do Sol" },
            { "prefixo": "PS-CDV", "empresa": "Costa do Sol" },
            { "prefixo": "PT-GAD", "empresa": "L√≠der" },
            { "prefixo": "PT-GAX", "empresa": "L√≠der" }
        ]

        // Configura√ß√µes
        const API_BASE = 'https://flightinfo.onrender.com/flights';
        // const API_BASE = 'https://3000-dlombellopla-flightinfo-lszderjlpav.ws-us120.gitpod.io/flights';

        // Cache para dados originais
        let originalFlightData = [];
        let filteredFlightData = [];

        // Elementos DOM
        const elements = {
            airport: () => document.getElementById('airport'),
            aircraft: () => document.getElementById('aircraft'),
            aircraftType: () => document.getElementById('aircraftType'),
            results: () => document.getElementById('results'),
            loading: () => document.getElementById('loading'),
            resultsCount: () => document.getElementById('resultsCount'),
            lastUpdate: () => document.getElementById('lastUpdate'),
            filterInfo: () => document.getElementById('filterInfo'),
            errorContainer: () => document.getElementById('errorContainer'),
            flightData: () => document.getElementById('flightData'),
            emptyState: () => document.getElementById('emptyState'),
            searchBtn: () => document.querySelector('.search-btn')
        };

        // Inicia o intervalo de atualiza√ß√£o de 3 em 3 minutos
        setInterval(startUpdateJob, 5 * 60 * 1000);
        let updateCounter = 0;
        elements.airport().value = '';
        elements.aircraft().value = '';

        // Adiciona o evento de clique em cada linha da tabela
        document.addEventListener('DOMContentLoaded', function () {
            const flightTable = document.getElementById('flightTable');

            flightTable.addEventListener('click', function (event) {
                const row = event.target.closest('tr');

                // Ignora o clique no cabe√ßalho
                if (!row || row.parentNode.tagName !== 'TBODY') return;

                const aircraftCell = row.cells[2]; // terceira coluna (√≠ndice 2) = Aeronave
                if (!aircraftCell) return;

                const aircraftCode = aircraftCell.textContent.trim().replace('-', '');
                const departureUTC = localTimeToUTC(row.cells[5].textContent.trim());
                let date = row.cells[0].textContent.split('-').join('');

                if (aircraftCode) {
                    const url = `https://pt.flightaware.com/live/flight/${aircraftCode}/history/${date}/${departureUTC}`;
                    window.open(url, '_blank');
                }
            });

            // Event listener para o filtro de tipo
            elements.aircraftType().addEventListener('change', applyFilters);
        });

        function localTimeToUTC(horaStr) {
            const match = horaStr.match(/^(\d{1,2}):(\d{2})\s*(-?\d{1,2})$/);
            if (!match) {
                console.error('Formato de hora inv√°lido:', horaStr);
                return null;
            }

            let [_, hora, minuto, offset] = match;
            hora = parseInt(hora);
            minuto = parseInt(minuto);
            offset = parseInt(offset);

            // Converte para UTC
            let horaUTC = hora + offset * -1;

            // Ajuste se passar de 24h ou for negativo
            if (horaUTC >= 24) horaUTC -= 24;
            if (horaUTC < 0) horaUTC += 24;

            return `${horaUTC.toString().padStart(2, '0')}${minuto.toString().padStart(2, '0')}Z`;
        }

        function startUpdateJob() {
            const airport = elements.airport().value.trim().toUpperCase();
            let aircraft = elements.aircraft().value.trim().toUpperCase();

            if (!airport && !aircraft) { return; }
            if (updateCounter >= 10) { location.reload(); }

            console.log(getActualDateTime() + ': Atualizando dos dados: ' + updateCounter);
            updateVoos();
        }

        function getActualDateTime() {
            const agora = new Date();

            const dia = String(agora.getDate()).padStart(2, '0');
            const mes = String(agora.getMonth() + 1).padStart(2, '0');
            const ano = agora.getFullYear();

            const hora = String(agora.getHours()).padStart(2, '0');
            const minuto = String(agora.getMinutes()).padStart(2, '0');

            return `${dia}/${mes}/${ano} ${hora}:${minuto}`;
        }

        // Fun√ß√£o para verificar se uma aeronave √© brasileira
        function isBrazilianHelicopter(aircraftId) {
            if (!aircraftId || aircraftId === '-') return false;

            // Converte o aircraftId para o formato com h√≠fen se n√£o tiver
            const formattedId = aircraftId.length === 5 ?
                aircraftId.slice(0, 2) + '-' + aircraftId.slice(2) :
                aircraftId;

            return aircraftsBr.some(aircraft => aircraft.prefixo === formattedId);
        }

        function determineAircraftType(aircraftId) {
            if (!aircraftId || aircraftId === '-') return 'unknown';

            // Primeiro verifica se √© um helic√≥ptero brasileiro
            if (isBrazilianHelicopter(aircraftId)) {
                return 'helicopter_br';
            }

            // Sen√£o, usa a l√≥gica original
            return aircraftId.length === 5 ? 'helicopter' : 'airplane';
        }

        function applyFilters() {
            const selectedType = elements.aircraftType().value;

            if (selectedType === 'all') {
                filteredFlightData = [...originalFlightData];
            } else {
                filteredFlightData = originalFlightData.filter(flight => {
                    const aircraftType = determineAircraftType(flight.aircraftId);
                    return aircraftType === selectedType;
                });
            }

            updateDisplayResults();
            updateFilterInfo();
        }

        function updateFilterInfo() {
            const filterInfo = elements.filterInfo();
            const selectedType = elements.aircraftType().value;

            if (selectedType === 'all') {
                filterInfo.style.display = 'none';
            } else {
                let typeLabel;
                switch (selectedType) {
                    case 'helicopter_br':
                        typeLabel = 'üöÅ Helic√≥pteros BR';
                        break;
                    case 'helicopter':
                        typeLabel = 'üö° Helic√≥pteros';
                        break;
                    case 'airplane':
                        typeLabel = '‚úàÔ∏è Avi√µes';
                        break;
                }
                filterInfo.innerHTML = `Filtro: ${typeLabel}`;
                filterInfo.style.display = 'inline-block';
            }
        }

        async function updateVoos() {
            updateCounter++;
            elements.lastUpdate().textContent = "";

            const airport = elements.airport().value.trim().toUpperCase();
            let aircraft = elements.aircraft().value.trim().toUpperCase();

            if (!airport && !aircraft) {
                showError('Informe pelo menos um filtro de busca');
                return;
            }

            showLoading(true);
            clearResults();

            try {
                const result = await noPrefixSearch(airport, aircraft);
                const dados = result.dados;
                aircraft = result.aircraft;
                originalFlightData = dados;
                applyFilters();
                elements.lastUpdate().textContent = `Atualizado em: ${getActualDateTime()}`;
            } catch (error) {
                showError(error.message);
            } finally {
                showLoading(false);
            }
        }

        // Fun√ß√£o principal de busca
        async function searchFlightsButton() {
            elements.lastUpdate().textContent = "";

            const airport = elements.airport().value.trim().toUpperCase();
            let aircraft = elements.aircraft().value.trim().toUpperCase();

            clearResults();

            if (!airport && !aircraft) {
                showError('Informe pelo menos um filtro de busca');
                return;
            }

            updateCounter = 0;
            showLoading(true);

            try {
                const result = await noPrefixSearch(airport, aircraft);
                const dados = result.dados;
                aircraft = result.aircraft;
                originalFlightData = dados;
                applyFilters();
                elements.lastUpdate().textContent = `Atualizado em: ${getActualDateTime()}`;
            } catch (error) {
                showError(error.message);
            } finally {
                showLoading(false);
            }
        }

        // Busca com tentativas autom√°ticas para c√≥digos de 3 letras
        async function noPrefixSearch(airport, aircraft) {
            aircraft = aircraft?.replace('-', '');

            const dados = await makeApiRequest(airport, aircraft);
            return { aircraft, dados };
        }

        // Faz a requisi√ß√£o para a API
        async function makeApiRequest(airport, aircraft) {
            const params = new URLSearchParams();
            if (airport) params.append('airport', airport);
            if (aircraft) params.append('aircraft', aircraft);

            const url = `${API_BASE}?${params.toString()}`;
            const response = await fetch(url);

            if (!response.ok) {
                throw new Error(`Erro ${response.status}: ${response.statusText}`);
            }

            const contentType = response.headers.get('content-type');
            if (!contentType?.includes('application/json')) {
                throw new Error('Resposta inv√°lida do servidor');
            }

            const data = await response.json();

            if (!Array.isArray(data.data)) {
                throw new Error('Formato de resposta inesperado');
            }

            return data.data;
        }

        function updateDisplayResults() {
            const airport = elements.airport().value.trim().toUpperCase();
            const aircraft = elements.aircraft().value.trim().toUpperCase();

            elements.resultsCount().textContent = `${filteredFlightData.length} voo${filteredFlightData.length !== 1 ? 's' : ''} encontrado${filteredFlightData.length !== 1 ? 's' : ''}`;

            if (filteredFlightData.length === 0) {
                elements.emptyState().style.display = 'block';
                elements.flightData().innerHTML = '';
                return;
            }

            elements.emptyState().style.display = 'none';

            const tbody = elements.flightData();
            const table = [];

            filteredFlightData.forEach(voo => {

                function formatarTextoPrefixo(texto) {
                    if (texto.length <= 2) return texto; // se tiver 2 ou menos, n√£o precisa alterar
                    return texto.slice(0, 2) + '-' + texto.slice(2);
                }

                const aircraftId = voo.aircraftId ? voo.aircraftId : aircraft || '-';
                const aircraftType = determineAircraftType(aircraftId);

                let icon, typeLabel, typeClass;

                switch (aircraftType) {
                    case 'helicopter_br':
                        icon = 'üöÅ';
                        typeLabel = 'HEL';
                        typeClass = 'helicopter_br';
                        break;
                    case 'helicopter':
                        icon = 'üö°';
                        typeLabel = 'HEL';
                        typeClass = 'helicopter';
                        break;
                    case 'airplane':
                        icon = '‚úàÔ∏è';
                        typeLabel = 'AVN';
                        typeClass = 'airplane';
                        break;
                    default:
                        icon = '‚ùì';
                        typeLabel = 'N/A';
                        typeClass = 'unknown';
                }

                table.push(`
          <tr class="flight-row" title="Clique para abrir o rastreamento">
            <td>${voo.date || '-'}</td>
            <td>
              <span class="aircraft-type ${typeClass}">
                ${icon} ${typeLabel}
              </span>
            </td>
            <td><strong>${aircraftId.length === 5 ? formatarTextoPrefixo(aircraftId) : aircraftId}</strong></td>
            <td class="flight-local">${voo.origin || airport}</td>
            <td class="flight-local">${voo.destination || '-'}</td>
            <td>${voo.departure || '-'}</td>
            <td>${voo.arrival || '-'}</td>
            <td>${voo.duration || '-'}</td>
            <td>üó∫Ô∏èüìç</td>
          </tr>
        `);
            });

            tbody.innerHTML = table.join('');
        }

        // Mostra/esconde indicador de carregamento
        function showLoading(show) {
            elements.loading().style.display = show ? 'block' : 'none';
            elements.searchBtn().disabled = show;
        }

        // Mostra mensagem de erro
        function showError(mensagem) {
            const container = elements.errorContainer();
            container.innerHTML = `<div class="error-message">${mensagem}</div>`;
            elements.results().style.display = 'block';
            elements.emptyState().style.display = 'none';
        }

        // Limpa os resultados
        function clearResults() {
            elements.errorContainer().innerHTML = '';
            elements.flightData().innerHTML = '';
            elements.resultsCount().textContent = '';
            elements.emptyState().style.display = 'none';
            elements.filterInfo().style.display = 'none';
            originalFlightData = [];
            filteredFlightData = [];
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Enter nos campos de input
            [elements.airport(), elements.aircraft()].forEach(input => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') searchFlightsButton();
                });
            });

            // Auto-uppercase nos inputs
            elements.airport().addEventListener('input', (e) => {
                e.target.value = e.target.value.toUpperCase();
            });

            elements.aircraft().addEventListener('input', (e) => {
                e.target.value = e.target.value.toUpperCase();
            });
        });
    </script>
</body>

</html>
